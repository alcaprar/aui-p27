<html>
<head>
    <title>Text</title>
    <meta name="description" content="Text - A-Frame">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="quiz.js"></script>
</head>
<body>
<script>
    var currentQuestion = 0;

    function setQuestion() {
        var questionText = quiz[currentQuestion].question;
        var option1Text = quiz[currentQuestion].options[0].option;
        var option2Text = quiz[currentQuestion].options[1].option;

        // set question text
        var questionElement = document.querySelector('#question');
        questionElement.setAttribute('text', {value: questionText});

        // set option1 text
        var option1Element = document.querySelector('#option1');
        option1Element.setAttribute('text', {value: option1Text});

        // set option2 text
        var option2Element = document.querySelector('#option2');
        option2Element.setAttribute('text', {value: option2Text})
    }

    function checkAnswer(optionSelected) {
        var correctAnswer = quiz[currentQuestion].options[0].isCorrect ? 0 : 1;
        console.log('Corr', correctAnswer, 'Sel', optionSelected);
        if(optionSelected === correctAnswer){
            alert('Well done!')
        }else{
            alert(':( try the next question.')
        }

        currentQuestion++;

        if(currentQuestion >= quiz.length){
            alert('Quiz finished!')
        }else{
            setQuestion()
        }
    }

    AFRAME.registerComponent('option1', {
        init: function () {
            this.timeout = null;
            this.el.addEventListener('mouseenter', function (evt) {
                this.timeout = setTimeout(function () {
                    checkAnswer(0)
                }, 3000)
            });

            this.el.addEventListener('mouseleave', function (evt) {
                clearTimeout(this.timeout)
            })
        }
    });

    AFRAME.registerComponent('option2', {
        init: function () {
            this.timeout = null;
            this.el.addEventListener('mouseenter', function (evt) {
                this.timeout = setTimeout(function () {
                    checkAnswer(1)
                }, 3000)
            });

            this.el.addEventListener('mouseleave', function (evt) {
                clearTimeout(this.timeout)
            })
        }
    });
</script>
<a-scene>
    <a-assets>
        <a-assets-item id="avatar" src="gltf/wiz_biz/scene.gltf"></a-assets-item>
    </a-assets>

    <a-entity camera="active: true; userHeight: 1.6" look-controls wasd-controls position="0 0 0">
        <a-cursor position="0 0 -1" fuse="true">
        </a-cursor>
    </a-entity>
    </a-entity>

    <a-gltf-model id="storyteller" position="-3 1 -3" scale="0.2 0.2 0.2" rotation="0 45 0" src="#avatar"></a-gltf-model>

    <a-triangle position="-1.7 2 -3" color="red" rotation="0 0 116" geometry="vertexA:0 0.8 0;vertexC:0.25 -0.5 0;vertexB:-0.25 -0.5 0"></a-triangle>

    <a-plane id="question" position="0.5 2.5 -3" heigth="3" width="4" color="red"
             text="color: blue; align: center; value: <QuestionText>; width: 4; ">
    </a-plane>


    <a-entity position="2 1 -3" option1>
        <a-entity id="option1" position="0 0.4 0" geometry="primitive: plane; width: 2; height: auto" material="color: green"
                  text="color: blue; align: center; value: <Answer1Text>; width: 4; ">
        </a-entity>
    </a-entity>

    <a-entity position="-1 1 -3" option2>
        <a-entity id="option2" position="0 0.4 0" geometry="primitive: plane; width: 2; height: auto" material="color: green"
                  text="color: blue; align: center; value: <Answer2Text>; width: 4; ">
        </a-entity>
    </a-entity>

    <!-- floor -->
    <a-plane rotation="-90 0 0" width="30" height="30" color="yellow"></a-plane>
</a-scene>

<script>
    // init the quiz with the first question
    setQuestion(0);
</script>
</body>
</html>